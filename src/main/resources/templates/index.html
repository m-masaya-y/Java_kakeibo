<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>収支管理</title>
  <style>
    body { font-family: sans-serif; display: flex; justify-content: center; padding: 20px; background: #f5f5f5; }
    .container { width: 100%; max-width: 900px; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center; }
    form { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 20px; }
    input, select, button { padding: 10px; border-radius: 6px; border: 1px solid #ccc; }
    button { cursor: pointer; border: none; background: #007bff; color: white; }
    button:hover { opacity: 0.9; }
    .month-box { border: 1px solid #87cefa; border-radius: 8px; margin-bottom: 20px; padding: 15px; background: #e3f2fd; }
    .month-header { font-weight: bold; font-size: 1.2em; margin-bottom: 10px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #87cefa; }
    .summary { margin-top: 10px; font-weight: bold; }
    @media (max-width: 600px) { input, select, button { width: 100%; } }
  </style>
</head>
<body>
<div class="container">
  <h2>収支管理アプリ</h2>

  <button onclick="location.href='https://minahada.com/wordpress/'" style="margin-bottom:20px; background:#444;">トップに戻る</button>

  <form th:action="@{/save}" method="post">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <select name="month">
      <option th:each="m : ${#numbers.sequence(1,12)}" th:value="${m}" th:text="${m + '月'}"></option>
    </select>
    <input type="number" name="income" placeholder="収入" value="0" required />
    <input type="number" name="expense" placeholder="支出" value="0" required />
    <button type="submit">保存</button>
  </form>

  <div th:each="m : ${#numbers.sequence(1,12)}" class="month-box" th:if="${#lists.size(dataList.?[month==m]) > 0}">
    <div class="month-header" th:text="${m + '月'}"></div>
    <table>
      <thead>
        <tr>
          <th>収入</th>
          <th>支出</th>
          <th>残額</th>
          <th>削除</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="item : ${dataList.?[month==m]}">
          <td th:text="${item.income}"></td>
          <td th:text="${item.expense}"></td>
          <td th:text="${item.income - item.expense}"></td>
          <td>
            <form th:action="@{/delete}" method="post">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
              <input type="hidden" name="id" th:value="${item.id}" />
              <button type="submit" style="background:#d9534f;">削除</button>
            </form>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="summary">
      合計： 収入 <span th:text="${#lists.sum(dataList.?[month==m].!income)}"></span> / 
      支出 <span th:text="${#lists.sum(dataList.?[month==m].!expense)}"></span> → 
      残額 <span th:text="${#lists.sum(dataList.?[month==m].!income) - #lists.sum(dataList.?[month==m].!expense)}"></span>
    </div>
  </div>
</div>
</body>
</html>
